[gcode_macro PARK_TOOL]
gcode:
	SAVE_GCODE_STATE NAME=park_tool

	{% set X = params.X|default(printer.toolhead.axis_minimum.x + 5)|float %}
	{% set Y = params.Y|default(printer.toolhead.axis_maximum.y - 5)|float %}
	{% set PARK_Z = params.PARK_Z|default("true")|string %}

	{% set MAX_Z = printer.toolhead.axis_maximum.z|float %}
	{% set CUR_Z = printer.toolhead.position.z|float %}
	{% set MOVE_Z = 25|float %}
	{% if (CUR_Z + MOVE_Z) < MAX_Z %}
		{% set SAFE_Z = (CUR_Z + MOVE_Z) %}
	{% else %}
		{% set SAFE_Z = MAX_Z %}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
		G90 ; Absolute positioning
		{% if PARK_Z|lower == "true" %}
			G1 Z{SAFE_Z} F1500
		{% endif %}
		G1 X{X} Y{Y} F3000
	{% else %}
		M117 Printer not homed
		RESPOND PREFIX="PARK_TOOL: " MSG="Printer not homed"
	{% endif %}


	RESTORE_GCODE_STATE NAME=park_tool